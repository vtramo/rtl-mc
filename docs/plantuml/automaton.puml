@startuml

/' Objects '/
package automaton {
    class BackwardNFA {
        --type aliases--
        +using EdgeIterator = spot::internal::state_out<spot::digraph<spot::twa_graph_state, spot::twa_graph_edge_data>>
        -using RenumberingContextVoidPtr = void*
        --data members--
        -m_discreteLtlFormula : DiscreteLtlFormula
        -m_formulaDenotationMap : PolyhedralSystemFormulaDenotationMap
        -m_backwardNfa : spot::twa_graph_ptr
        -m_stateDenotationById : std::unordered_map<int, StateDenotation>
        -m_initialStates : std::unordered_set<int>
        -m_finalStates : std::unordered_set<int>
        -m_dummyInitialState : int
        -m_dummyInitialEdges : int
        -m_optimizationLevel : spot::postprocessor::optimization_level
        -m_automatonStats : AutomatonStats
        --constructors--
        +BackwardNFA(const DiscreteLtlFormula& discreteLtlFormula, PolyhedralSystemFormulaDenotationMap&& polyhedralSystemLabelDenotationMap, spot::postprocessor::optimization_level optimizationLevel = spot::postprocessor::optimization_level::High, bool anyOption = false)
        +BackwardNFA(DiscreteLtlFormula&& discreteLtlFormula, PolyhedralSystemFormulaDenotationMap&& polyhedralSystemFormulaDenotationMap, spot::postprocessor::optimization_level optimizationLevel = spot::postprocessor::optimization_level::High, bool anyOption = false)
        --member functions--
        +formula() : const DiscreteLtlFormula&
        +predecessors(int state) : EdgeIterator
        +countPredecessors(int state) : int
        +stateDenotation(int state) : const StateDenotation&
        +hasPredecessors(int state) : bool
        +isFinalState(int state) : bool
        +isInitialState(int state) : bool
        +totalEdges() : int
        +totalInitialStates() : int
        +totalFinalStates() : int
        +totalStates() : int
        +initialStates() : const std::unordered_set<int>&
        +finalStates() : const std::unordered_set<int>&
        +optimizationLevel() : spot::postprocessor::optimization_level
        +stats() : AutomatonStats& const
        +printDotFormat(std::ostream& os) : void
        +printHoaFormat(std::ostream& os) : void
        -buildAutomaton(const spot::const_twa_graph_ptr& nfa, const std::unordered_set<int>& nfaAcceptingStates) : void
        -extractStateDenotationFromEdgeGuard(const spot::const_twa_graph_ptr& nfa, const bdd& guard) : StateDenotation
        -createDummyInitialStateWithEdgesToReachableFinalStates() : void
        -translateDiscreteLtlFormulaIntoTgba(bool anyOption) : spot::twa_graph_ptr
        -convertToNfa(spot::twa_graph_ptr tgba) : spot::twa_graph_ptr
        -purgeUnreachableStatesThenRenumberFinalStates(spot::twa_graph_ptr nfa, std::unordered_set<int>& nfaFinalStates) : void
        -twa() : spot::const_twa_ptr
        --static functions--
        -{static} renumberOrRemoveStatesAfterPurge(const std::vector<unsigned>& newst, RenumberingContextVoidPtr renumberingContextVoidPtr) : void
        -{static} killFinalStates(const spot::twa_graph_ptr& graph) : std::unordered_set<int>
        --friends--
        -friend class BackwardNFADepthFirstSearch;
        --operators--
        +operator<< (std::ostream& out, const BackwardNFA& backwardNfa) : std::ostream&
    }

    struct RenumberingContext {
        --data members--
        m_initialStates : std::unordered_set<int>*
        m_finalStates : std::unordered_set<int>*
        m_stateDenotationById : std::unordered_map<int, StateDenotation>*
        m_dummyInitialState : int*
        --constructors--
        RenumberingContext(std::unordered_set<int>* initialStates, std::unordered_set<int>* finalStates, std::unordered_map<int, StateDenotation>*, int* dummyInitialState)
        explicit RenumberingContext(std::unordered_set<int>* finalStates)
    }

    class PolyhedralSystemFormulaDenotationMap {
        --type aliases--
        -using FormulaToString = std::string;
        -using FormulaId = size_t;
        --data members--
        -m_polyhedralSystem : PolyhedralSystemConstSharedPtr
        -m_powersetByFormula : std::unordered_map<FormulaId, std::tuple<PowersetConstSharedPtr, FormulaToString>>
        --constructors--
        +PolyhedralSystemFormulaDenotationMap(PolyhedralSystemConstSharedPtr polyhedralSystem)
        +PolyhedralSystemFormulaDenotationMap(PolyhedralSystemFormulaDenotationMap&& other)
        -PolyhedralSystemFormulaDenotationMap() = default
        --member functions--
        +getPolyhedralSystem() : const PolyhedralSystem&
        +getOrComputeDenotation(const spot::formula& formula) : PowersetConstSharedPtr
        +containsDenotation(const spot::formula& formula) : bool
        -computeFormulaDenotation(const spot::formula& formula) : PowersetConstSharedPtr
        -getAtomInterpretation(const spot::formula& formula) : const AtomInterpretation*
        -void saveFormulaDenotation(const spot::formula& formula, PowersetConstSharedPtr denotation) : void
        --operators--
        +operator<< (std::ostream& out, PolyhedralSystemFormulaDenotationMap& polyhedralSystemFormulaDenotationMap) : std::ostream&
    }

    class StateDenotation {
        --data members--
        -m_formula : spot::formula
        -m_denotation : PowersetConstSharedPtr
        -m_isSing : bool
        --constructors--
        +StateDenotation(spot::formula&& formula, PowersetConstSharedPtr denotation, const bool isSing = false)
        +StateDenotation(StateDenotation&& other)
        --member functions--
        +formula() : const spot::formula&
        +denotation() : PowersetConstSharedPtr
        +isSingular() : bool
        +isUniverse() : bool
        +isEmpty() : bool
        +toString(const PolyhedralSystemSymbolTable& symbolTable) : std::string
        +print(std::ostream& ostream, const PolyhedralSystemSymbolTable& symbolTable) : void
    }

    class BackwardNFADepthFirstSearch {
        --data members--
        -m_backwardNfa : const BackwardNFA*
        --constructors--
        +explicit BackwardNFADepthFirstSearch(const BackwardNFA& backwardNfa)
        --virtual member functions--
        +virtual wantState(int state) const : bool
        +virtual processState(int state) : void
        +virtual processEdge(int src, int dst) : void
        --member functions--
        +run() final: void
        -want_state(const spot::state* state) const final : bool
        -process_state(const spot::state* s, int n, spot::twa_succ_iterator* si) final : void
        -process_link(
            const spot::state* in_s,
            int in,
            const spot::state* out_s,
            int out,
            const spot::twa_succ_iterator* si
        ) final : void
        -push(const spot::state* s, int sn) final : void
        -pop() final : void
    }

    class twa_reachable_iterator_depth_first << spot >>
    {
      --data members--
      #const_twa_ptr aut_
      #state_map<int> seen
      #std::deque<stack_item> todo
      --constructors--
      +twa_reachable_iterator_depth_first(const const_twa_ptr& a)
      --virtual destructors--
      +virtual ~twa_reachable_iterator_depth_first()
      --virtual member functions--
      +virtual run() : void
      +virtual want_state(const state* s) : bool
      +virtual start() : void
      +virtual end() : void
      +virtual process_state(const state* s, int n, twa_succ_iterator* si) : void
      +virtual process_link(
        const state* in_s, int in,
        const state* out_s, int out,
        const twa_succ_iterator* si
      ) : void
      #virtual push(const state* s, int sn) : void
      #virtual pop() : void
    }

    struct stack_item << spot >>
    {
      --data members--
      src : const state*
      src_n : int
      it : twa_succ_iterator*
    }
}

class twa_graph_ptr << spot >> {}
class formula << spot >> {}

BackwardNFA *--> "1" twa_graph_ptr
BackwardNFA *--> "1" formula
BackwardNFA *--> "1" PolyhedralSystemFormulaDenotationMap
BackwardNFA *--> "*" StateDenotation
BackwardNFA #--> RenumberingContext
twa_reachable_iterator_depth_first #--> "*" stack_item
BackwardNFADepthFirstSearch --|> twa_reachable_iterator_depth_first
@enduml
